# PRD (Product Requirements Document): 퀘스트 시스템

## 1. 프로젝트 개요

### 1.1 목적
주식 교육 앱에서 사용자 참여를 유도하고 금융 지식 학습을 게임화하기 위한 퀘스트 시스템 구현[1]

### 1.2 범위
- 일일 퀘스트
- 주간 퀘스트
- 월간 퀘스트
- 유료 퀘스트 (고급 금융지식 문제)
- 깜짝 이벤트 퀘스트

***

## 2. 핵심 기능 요구사항

### 2.1 퀘스트 공통 기능

#### 2.1.1 데이터베이스 관리
- 모든 퀘스트는 데이터베이스에서 관리[1]
- 퀘스트 상태 추적 (진행 중, 완료, 실패)
- 퀘스트 만료 시간 관리

#### 2.1.2 도전 제한 및 확인
- **1회 도전 제한**: 모든 퀘스트는 한 번만 도전 가능
- **도전 확인 팝업**: 퀘스트 클릭 시 다음 문구 표시
  - "이 퀘스트는 한 번만 도전할 수 있습니다."
  - "실패 시 퀘스트가 사라집니다."
  - "도전하시겠습니까?"
  - 버튼: [취소] [도전하기]
  - **5지선다 객관식일 것**

#### 2.1.3 타이머 기능
- 문제 풀이 시작 시 타이머 작동
- 제한 시간 내 문제 해결 필요
- 시간 초과 시 자동 실패 처리[1]

#### 2.1.4 실패 처리
- 실패 시 해당 퀘스트 자동 삭제
- 재도전 불가능
- 실패 기록 저장 (통계용)

---

## 3. 퀘스트 유형별 상세 요구사항

### 3.1 일일 퀘스트

#### 3.1.1 특징
- 매일 00:00 초기화[1]
- 무료 회원 이용 가능
- 반복 가능한 일상 미션

#### 3.1.2 퀘스트 예시
| 퀘스트명 | 목표 | 보상 |
|---------|------|------|
| 오늘의 학습 | 문제 3개 이상 풀기 | 경험치 100 |
| 꾸준한 학습자 | 오늘의 학습 완료 | 골드 50 |
| 완벽주의자 | 정답률 80% 이상 달성 | 경험치 150 |

---

### 3.2 주간 퀘스트

#### 3.2.1 특징
- 매주 월요일 00:00 초기화[1]
- 무료 회원 이용 가능
- 장기 목표 달성 유도

#### 3.2.2 퀘스트 예시
| 퀘스트명 | 목표 | 보상 |
|---------|------|------|
| 출석왕 | 5일 연속 출석하기 | 경험치 500, 골드 200 |
| 연승 행진 | 10문제 연속 맞추기 | 경험치 300, 특별 배지 |
| 주간 목표 달성 | 주간 학습 목표 완료 | 골드 300 |
| 완벽한 한 주 | 모든 일일 퀘스트 완료 | 경험치 700, 골드 400 |

---

### 3.3 월간 퀘스트

#### 3.3.1 특징
- 매월 1일 00:00 초기화
- 무료 회원 이용 가능
- 장기 목표 및 경쟁 시스템 연동
- 높은 난이도와 프리미엄 보상[2][3]

#### 3.3.2 월간 퀘스트 목록

**1. 리그 상위 랭커 도전**
- 목표: 리그에서 상위 20% 안에 들기
- 보상: 일라이릴리 주식 확정 보상
- 조건: 무료 회원 포함 모든 회원
- 진행률 표시: 현재 순위 / 상위 20% 컷라인

**2. 완벽한 출석 마스터**
- 목표: 연속 출석 25회 이상
- 보상: 마이크로소프트 주식 응모권
- 조건: 무료 회원 포함 모든 회원
- 진행률 표시: 현재 연속 출석 일수 / 25일

**3. 학습왕 도전**
- 목표: 월간 문제 풀이 500개 이상
- 보상: 애플 주식 응모권
- 조건: 무료 회원 포함 모든 회원
- 진행률 표시: 현재 풀이 수 / 500개

**4. 완벽주의자**
- 목표: 월간 정답률 90% 이상 유지
- 보상: 구글 주식 응모권
- 조건: 최소 100문제 이상 풀이 필수
- 진행률 표시: 현재 정답률 / 90%

**5. 유료 퀘스트 마스터**
- 목표: 유료 퀘스트 3개 모두 성공
- 보상: 엔비디아 주식 확정 보상
- 조건: 유료 회원 전용
- 진행률 표시: 성공한 퀘스트 수 / 3개

#### 3.3.3 월간 퀘스트 카드 표시 정보
- 퀘스트 제목
- 목표 달성률 프로그레스 바
- 남은 기간 표시 (예: "D-15")
- 보상 정보 (주식명 + 확정/응모권)
- 달성 조건 요약

#### 3.3.4 월간 퀘스트 진행률 추적
- 실시간 진행률 업데이트
- 목표 달성 시 자동 완료 처리
- 월말까지 미달성 시 자동 실패 처리[2]

#### 3.3.5 리그 시스템 연동
- 월간 리그 순위 실시간 반영
- 상위 20% 컷라인 동적 계산
- 순위 변동 알림 기능

***

### 3.4 유료 퀘스트 (고급 금융지식)

#### 3.4.1 특징
- **회원 제한**: 유료 회원만 접근 가능
- **월 제한**: 한 달에 3번까지 도전 가능
- **보상**: 실제 소수점 주식 지급
- **난이도**: 투자자산운용사 시험 수준

#### 3.4.2 퀘스트 카드 표시 정보
- 퀘스트 제목 (예: "채권 볼록성 활용 문제")
- 보상 정보 (예: "엔비디아 소수점주식 1,000원")
- 제한 시간 (예: "30초")
- 회원 등급 표시 ("유료 회원 전용" 배지)
- 남은 도전 횟수 표시 (예: "이번 달 2/3회 남음")

#### 3.4.3 퀘스트 클릭 후 표시 정보
- 실제 문제 내용
- 타이머 시작
- 답안 입력/선택 UI

#### 3.4.4 유료 퀘스트 목록

**1. 채권 볼록성 활용 문제**
- 문제: 액면가 10,000원, 표면이자율 6%, 만기 2년, 만기수익률 10%인 채권의 볼록성(Convexity)을 계산하시오
- 제한: 30초
- 보상: 엔비디아 소수점주식 1,000원
- 회원: 유료 전용

**2. 부동산 가치평가 문제**
- 문제: 부동산의 미래가치를 계산하는 방식이 아닌 것은?
  ① DCF(현금흐름할인법) ② 수익환원법 ③ 거래사례비교법 ④ 블랙-숄즈 모델
- 제한: 20초
- 보상: 테슬라 소수점주식 1,000원
- 회원: 유료 전용

**3. 듀레이션 계산 문제**
- 문제: 만기수익률 15%, 표면이자율 12%, 액면금액 1,000원, 만기 5년인 채권의 맥컬리 듀레이션을 계산하시오
- 제한: 30초
- 보상: 삼성전자 소수점주식 1,000원
- 회원: 유료 전용

**4. CAPM 모델 문제**
- 문제: 무위험수익률 3%, 시장수익률 10%, 베타 1.5인 주식의 기대수익률은?
  ① 9.5% ② 10.5% ③ 13.5% ④ 15%
- 제한: 20초
- 보상: 애플 소수점주식 1,000원
- 회원: 유료 전용

**5. 채권 가격 변동성 문제**
- 문제: 수정듀레이션 7.5, 볼록성 120일 때, 만기수익률 2% 상승 시 채권 가격 변화율은?
  ① -12.6% ② -10.2% ③ -15.0% ④ -7.8%
- 제한: 40초
- 보상: 마이크로소프트 소수점주식 1,000원
- 회원: 유료 전용

**6. 포트폴리오 이론 문제**
- 문제: 효율적 프론티어 상의 포트폴리오가 아닌 것은?
  ① 최소분산 포트폴리오 ② 최대 샤프비율 포트폴리오 ③ 시장 포트폴리오 ④ 최대손실 포트폴리오
- 제한: 5초
- 보상: 아마존 소수점주식 1,000원
- 회원: 유료 전용

**7. 채권 면역전략 문제**
- 문제: 듀레이션 매칭 면역전략에서 고려 사항이 아닌 것은?
  ① 듀레이션 일치 ② 자산 현재가치 ≥ 부채 현재가치 ③ 볼록성 최대화 ④ PER 최소화
- 제한: 20초
- 보상: 카카오 소수점주식 1,000원
- 회원: 유료 전용

**8. 파생상품 평가 문제**
- 문제: 블랙-숄즈 모델의 기본 가정이 아닌 것은?
  ① 무위험 차익거래 불가능 ② 변동성이 시간에 따라 변함 ③ 연속적 거래 가능 ④ 무위험이자율 일정
- 제한: 20초
- 보상: 네이버 소수점주식 1,000원
- 회원: 유료 전용

**9. VaR 계산 문제**
- 문제: 95% 신뢰수준 일일 VaR 500만원의 의미는?
  ① 5일 중 1일은 500만원 이상 손실 ② 100일 중 95일은 500만원 이하 손실 ③ 최대 손실액 500만원 ④ 평균 손실액 500만원
- 제한: 30초
- 보상: 현대차 소수점주식 1,000원
- 회원: 유료 전용

**10. 채권 스프레드 문제**
- 문제: 회사채 스프레드 확대 원인이 아닌 것은?
  ① 신용등급 하락 ② 유동성 위험 증가 ③ 무위험이자율 하락 ④ 시장 신뢰도 저하
- 제한: 20초
- 보상: LG전자 소수점주식 1,000원
- 회원: 유료 전용

***

### 3.5 깜짝 이벤트 퀘스트 (주간/일일)

#### 3.5.1 특징
- **회원 제한**: 모든 회원 참여 가능 (무료 포함)
- **선착순**: 50명 선착순
- **보상**: 주식 응모권
- **난이도**: 높음 (극한의 시간 제한)
- **출현**: 랜덤 시간에 등장[2]

#### 3.5.2 깜짝 퀘스트 목록

**1. 옵션 합성 전략 문제**
- 문제: 옵션 합성 전략이 아닌 것은?
  ① Protective Put ② Covered Call ③ Straddle ④ Martingale Strategy
- 제한: 5초
- 보상: 테슬라 주식 응모권 (50명 선착순)
- 회원: 모든 회원

**2. 채권 수익률 곡선 문제**
- 문제: 수익률 곡선 역전 시 예상 경제 상황은?
  ① 경기 과열 ② 경기 침체 가능성 ③ 인플레이션 급등 ④ 외환위기
- 제한: 5초
- 보상: SK하이닉스 주식 응모권 (50명 선착순)
- 회원: 모든 회원

***

## 4. UI/UX 요구사항

### 4.1 퀘스트 카드 (문제 풀기 전)

#### 4.1.1 표시 정보
- 퀘스트 제목
- 보상 정보 (아이콘 + 텍스트)
- 제한 시간
- 회원 등급 배지
- 유료 퀘스트: 남은 도전 횟수
- 깜짝 퀘스트: 남은 인원 (예: "34/50명 남음")
- 월간 퀘스트: 진행률 프로그레스 바 + 남은 기간

#### 4.1.2 카드 디자인
- 일반 퀘스트: 기본 배경
- 유료 퀘스트: 골드 테두리 + 프리미엄 배지
- 깜짝 퀘스트: 반짝이는 이펙트 + "깜짝!" 라벨
- 월간 퀘스트: 보라색 테두리 + "월간" 배지 + 프로그레스 바[1]

### 4.2 도전 확인 팝업

#### 4.2.1 구성 요소
```
[팝업 제목] 퀘스트 도전

[경고 아이콘]
이 퀘스트는 한 번만 도전할 수 있습니다.
실패 시 퀘스트가 사라집니다.

[퀘스트 정보 요약]
- 제한 시간: XX초
- 보상: OO 주식 1,000원

도전하시겠습니까?

[취소]  [도전하기]
```

### 4.3 문제 풀이 화면 (퀘스트 클릭 후)

#### 4.3.1 레이아웃
```
[상단]
타이머: XX초 남음 (실시간 카운트다운)

[중앙]
문제 내용

[하단]
- 객관식: 선택지 버튼
- 주관식: 답안 입력창

[제출 버튼]
```

#### 4.3.2 타이머 표시
- 30초 이상: 파란색
- 10-30초: 주황색
- 10초 미만: 빨간색 + 깜빡임

### 4.4 결과 화면

#### 4.4.1 성공 시
```
[성공 아이콘]
정답입니다!

보상을 획득했습니다:
[주식 아이콘] OO 소수점주식 1,000원

[확인]
```

#### 4.4.2 실패 시
```
[실패 아이콘]
아쉽습니다!

이 퀘스트는 사라집니다.
다음 기회를 노려보세요!

[확인]
```

### 4.5 월간 퀘스트 진행 화면

#### 4.5.1 월간 퀘스트 전용 UI
```
[퀘스트 제목]
리그 상위 랭커 도전

[진행률 바]
████████░░░░░░░░░░ 42%

[상세 정보]
현재 순위: 152위
상위 20% 컷라인: 180위
남은 기간: D-12

[보상]
일라이릴리 주식 확정 보상

[목표까지] 28위 상승 필요
```


## 7. 비즈니스 로직

### 7.1 월간 퀘스트 자동 추적
- 사용자 활동(출석, 문제 풀이, 리그 순위) 발생 시 월간 퀘스트 진행률 자동 업데이트
- 목표 달성 시 자동 완료 처리 및 알림 발송
- 매일 자정 진행률 재계산[1]

### 7.2 리그 순위 연동
- 리그 점수 변동 시 실시간 순위 업데이트
- 상위 20% 컷라인 동적 계산 (전체 사용자 수 기준)
- 월말 최종 순위로 보상 지급 여부 결정

### 7.3 퀘스트 리셋 스케줄
- 일일 퀘스트: 매일 00:00 리셋
- 주간 퀘스트: 매주 월요일 00:00 리셋
- 월간 퀘스트: 매월 1일 00:00 리셋
- 유료 퀘스트 도전 횟수: 매월 1일 00:00 리셋[1]

---

## 8. 보안 및 부정행위 방지

### 8.1 타이머 검증
- 클라이언트 타이머와 서버 타이머 이중 체크[1]
- 서버 측에서 시작 시간 기록 후 제출 시간 검증
- 제한 시간 초과 시 자동 실패 처리

### 8.2 중복 제출 방지
- 퀘스트 상태를 'in_progress'로 변경
- 이미 제출된 퀘스트는 재제출 불가
- 트랜잭션 처리로 동시성 제어

### 8.3 보상 중복 지급 방지
- 보상 지급 전 퀘스트 완료 여부 재확인
- 트랜잭션 처리로 원자성 보장
- 지급 이력 로그 기록

### 8.4 월간 퀘스트 조작 방지
- 리그 점수 변동 이력 추적
- 비정상적인 점수 상승 패턴 감지
- 의심 계정 자동 검토 시스템

***

## 9. 성능 요구사항

### 9.1 응답 시간
- 퀘스트 목록 조회: 500ms 이내
- 답안 제출 및 채점: 1초 이내
- 타이머 동기화: 100ms 이내
- 월간 퀘스트 진행률 조회: 300ms 이내

### 9.2 동시 접속
- 깜짝 퀘스트 선착순 처리 시 최소 1,000 TPS 지원
- 락(Lock) 메커니즘으로 순위 정확성 보장
- 월말 리그 순위 계산 시 캐싱 활용

***

## 10. 알림 및 푸시 메시지

### 10.1 월간 퀘스트 알림
- 목표 달성 임박 알림 (90% 달성 시)
- 목표 달성 완료 알림
- 월말 3일 전 미달성 경고 알림
- 리그 순위 변동 알림 (상위 20% 진입/탈락 시)

### 10.2 깜짝 퀘스트 알림
- 깜짝 퀘스트 등장 푸시 알림
- 선착순 마감 임박 알림 (45/50 달성 시)

---

## 11. 향후 확장 계획

### 11.1 추가 기능
- 퀘스트 난이도 조절 시스템
- 사용자별 맞춤 퀘스트 추천
- 퀘스트 달성 기록 및 통계
- 리더보드 및 랭킹 시스템[3][2]

### 11.2 게임화 요소 강화
- 연속 달성 보너스 (스트릭)
- 특별 업적 및 배지 시스템
- 친구와 퀘스트 대결 기능
- 시즌별 특별 퀘스트

이상으로 월간 퀘스트를 포함한 전체 퀘스트 시스템 PRD 문서입니다. 월간 퀘스트는 리그 시스템과 연동되어 장기적인 사용자 참여를 유도하며, 확정 보상을 통해 높은 동기부여를 제공합니다.