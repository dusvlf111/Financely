# 퀘스트 기능 TODO (세로형)

> 이 파일은 `퀘스트 기능` 구현 전용 작업 목록입니다. 각 하위 작업은 테스트 작성/실행/수정 항목을 포함합니다. 작업 완료 후 한 항목씩 체크하고 사용자 승인(yes/y)을 받습니다.

- [x] 1.0 DB 모델 설계 및 마이그레이션
	- 설명: `quests`, `user_quests`, `quest_rewards` 등 테이블 설계. 상태(status), 만료시간(expire_at), 시도제한(attempts_allowed) 포함.
	- 테스트:
		- [x] 1.0.1 퀘스트 모델 단위 테스트 작성 (CRUD, 상태 전이, 만료)
		- [x] 1.0.2 테스트 실행 및 검증
		- [x] 1.0.3 테스트 실패 시 오류 수정 (테스트 성공으로 수정 사항 없음)

- [x] 2.0 서버 API 및 비즈니스 로직 구현 (완료)
	- 설명: 퀘스트 목록 조회, 도전 시작(in_progress 전환), 제출 처리, 실패 처리, 보상 지급, 트랜잭션 처리.
	- 테스트:
		- [x] 2.0.1 API/로직 단위 및 통합 테스트 작성 (동시성 포함)
		- [x] 2.0.2 테스트 실행 및 검증
		- [x] 2.0.3 오류 수정 (필요 없음)
	- API 라우트 구현:
		- [x] 2.0.4 Next.js API 라우트 핸들러 구현
			- [x] 2.0.4.1 테스트 코드 작성
			- [x] 2.0.4.2 테스트 실행 및 검증
			- [x] 2.0.4.3 오류 수정 (필요 없음)

- [x] 3.0 클라이언트 UI/UX 구현
	- 설명: 퀘스트 카드, 도전 확인 팝업, 문제 풀이 화면, 결과 모달, 타이머 UI(색상 변경/깜빡임).
	- 테스트:
		- [x] 3.0.1 컴포넌트 유닛/통합 테스트 작성 (React Testing Library) — `tests/quest.page.test.tsx`
		- [x] 3.0.2 테스트 실행 및 검증 — `npm run test -- quest.page.test.tsx`
		- [x] 3.0.3 오류 수정
		- [x] 3.0.4 DB 미연결 시 퀘스트 Mock 데이터 fallback
			- [x] 3.0.4.1 테스트 코드 작성 — `tests/quest.api.test.ts`
			- [x] 3.0.4.2 테스트 실행 및 검증 — `npm run test -- quest.api.test.ts`
			- [x] 3.0.4.3 오류 수정 (필요 시)
			- [x] 3.0.5 깜짝 퀘스트 인터랙션 구현
			- [x] 3.0.5.1 테스트 코드 작성 — `tests/quest.page.test.tsx`
			- [x] 3.0.5.2 테스트 실행 및 검증 — `npm run test -- quest.page.test.tsx`
			- [x] 3.0.5.3 오류 수정 (필요 시)
				- [x] 3.0.5.4 로딩 상태 깜박임 제거
					- [x] 3.0.5.4.1 테스트 코드 작성 — `tests/quest.page.test.tsx`
					- [x] 3.0.5.4.2 테스트 실행 및 검증 — `npm run test -- quest.page.test.tsx`
					- [x] 3.0.5.4.3 오류 수정 (필요 시)
			- [x] 3.0.6 문제 풀이 성공 메시지 자연어 수정
				- [x] 3.0.6.1 테스트 코드 작성 — `tests/problem.success.test.tsx`
				- [x] 3.0.6.2 테스트 실행 및 검증 — `npm run test -- problem.success.test.tsx`
				- [x] 3.0.6.3 오류 수정 (필요 시)
			- [x] 3.0.7 퀘스트 목록 스켈레톤 표시 타이밍 조정
				- [x] 3.0.7.1 테스트 코드 작성 — `tests/quest.page.test.tsx`
				- [x] 3.0.7.2 테스트 실행 및 검증 — `npm run test -- quest.page.test.tsx`
				- [x] 3.0.7.3 오류 수정 (필요 시)
			- [x] 3.0.8 퀘스트 목록 로딩 애니메이션 안정화
				- [x] 3.0.8.1 테스트 코드 작성 — `tests/quest.page.test.tsx`
				- [x] 3.0.8.2 테스트 실행 및 검증 — `npm run test -- quest.page.test.tsx`
				- [x] 3.0.8.3 오류 수정 (필요 시)
			- [ ] 3.0.9 퀘스트 진행 RPC 오류 수정
				- [ ] 3.0.9.1 테스트 코드 작성 — `tests/auth.trackQuestProgress.test.ts`
				- [ ] 3.0.9.2 테스트 실행 및 검증 — `npm run test -- auth.trackQuestProgress.test.ts`
				- [ ] 3.0.9.3 오류 수정 (필요 시)
			- [ ] 3.0.10 문제 성공 메시지 띄어쓰기 보정
				- [x] 3.0.10.1 테스트 코드 작성 — `tests/problem.success.test.tsx`
				- [x] 3.0.10.2 테스트 실행 및 검증 — `npm run test -- problem.success.test.tsx`
				- [x] 3.0.10.3 오류 수정 (필요 시)
- [x] 3.1 데이터 베이스에 데이터를 넣고 확인하기
	- 설명: 초기 퀘스트 데이터를 DB에 시드하고 조회가 정상 동작하는지 확인.
	- 테스트:
		- [x] 3.1.1 테스트 코드 작성 — `tests/quest.seed.test.ts`
		- [x] 3.1.2 테스트 실행 및 검증 — `npm run test -- quest.seed.test.ts`
		- [x] 3.1.3 오류 수정 — `src/lib/quests/seed.ts` TRUNCATE 대체 경로 추가
		- [x] 3.1.4 퀘스트 데이터 페이지에 띄우기 — `src/app/quest/page.tsx` API 연동 및 렌더링 개선
		- [x] 3.1.5 깜짝 퀘스트 업서트 지원
			- [x] 3.1.5.1 테스트 코드 작성 — `tests/quest.seed.test.ts`
			- [x] 3.1.5.2 테스트 실행 및 검증 — `npm run test -- quest.seed.test.ts`
			- [x] 3.1.5.3 오류 수정 (필요 시)

- [ ] 4.0 보안 및 부정행위 방지
	- 설명: 서버 타이머 검증(서버 기록/검증), 중복 제출 방지, 보상 중복 지급 방지(원자적 트랜잭션), 의심 계정 감지 기초.
	- 테스트:
		- [x] 4.0.1 타이머 위조/중복 제출/보상 중복 케이스 테스트 작성 — `tests/quest.api.test.ts`
		- [x] 4.0.2 테스트 실행 및 검증 — `npm run test -- quest.api.test.ts`
		- [ ] 4.0.3 오류 수정

- [ ] 5.0 리셋 스케줄링 (일/주/월)
	- 설명: 일일/주간/월간 퀘스트 초기화 및 유료 퀘스트 카운트 리셋(서버 Cron 또는 스케줄러).
	- 테스트:
		- [ ] 5.0.1 스케줄링 동작 시뮬레이션 테스트 작성
		- [ ] 5.0.2 테스트 실행 및 검증
		- [ ] 5.0.3 오류 수정

- [ ] 6.0 통합 및 부하 테스트
	- 설명: 깜짝 퀘스트 선착순 처리 등 고부하 시나리오 시뮬레이션(예: 선착순 50명, 목표 1,000 TPS 목표 검증).
	- 테스트:
		- [ ] 6.0.1 부하 테스트 스크립트 작성 (k6 또는 간단 Node 스크립트)
		- [ ] 6.0.2 부하 테스트 실행 및 결과 분석
		- [ ] 6.0.3 병목 개선 작업

- [ ] 7.0 문서화 및 PRD 업데이트
	- 설명: API 스펙, 데이터 모델 문서화 및 `docs/` 업데이트.
	- 테스트:
		- [ ] 7.0.1 문서 예제 검증 스크립트 작성 (Postman 또는 스크립트)
		- [ ] 7.0.2 테스트 실행 및 검증
		- [ ] 7.0.3 문서 수정

- [ ] 8.0 릴리스 및 배포 준비
	- 설명: 마이그레이션 적용/롤백 계획, 릴리스 노트, 배포 스크립트 준비.
	- 테스트:
		- [ ] 8.0.1 릴리스 전 점검 스크립트 작성 (마이그레이션/헬스체크)
		- [ ] 8.0.2 스테이징 배포 및 검증
		- [ ] 8.0.3 배포 오류 수정

## 관련 파일
- `docs/1_Todo/퀘스트기능_PRD.md` - PRD 원문
- `docs/1_Todo/퀘스트기능_todo.md` - (현재 파일) 세로형 작업 목록
- `supabase/migrations/000_create_quest_tables.sql` - 퀘스트 관련 테이블 마이그레이션
- `supabase/migrations/001_add_unique_index_on_quests_title.sql` - 퀘스트 타이틀 고유성 보장 인덱스
- `tests/quest.schema.test.ts` - 마이그레이션 스키마 텍스트 검증 테스트
- `tests/quest.model.test.ts` - pg-mem 기반 퀘스트 DB 동작 테스트
- `tests/quest.service.test.ts` - 퀘스트 서비스 로직 단위 및 통합 테스트
- `tests/quest.page.test.tsx` - 퀘스트 UI 인터랙션 테스트
- `src/app/quest/page.tsx` - 퀘스트 UI 렌더링 및 타입별 섹션 관리
- `src/lib/quests/service.ts` - 퀘스트 도전/제출/실패 서버 로직 구현
- `jest.setup.ts` - Jest 환경 설정 및 글로벌 폴리필 관리

## 진행 규칙 (요약)
- 각 하위 작업 완료 시 반드시 체크하고 커밋합니다.
- 모든 하위 작업이 완료되면 상위 작업을 체크합니다.
- 각 하위 작업은 완료 후 사용자 승인(y/yes)을 받습니다.

